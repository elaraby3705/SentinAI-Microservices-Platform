# ==========================================
# 1. Service B: Node.js (The Receiver)
# We deploy this first so it gets an IP/DNS name
# ==========================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sentin-alert-deployment
spec:
  replicas: 2  # 2 Replicas for High Availability
  selector:
    matchLabels:
      app: sentin-alert
  template:
    metadata:
      labels:
        app: sentin-alert
    spec:
      containers:
      - name: sentin-alert
        # Use the v1 image (since Node.js code hasn't changed)
        image: docker.io/YOUR_USER/sentin-alert:v1
        ports:
        - containerPort: 3000
---
apiVersion: v1
kind: Service
metadata:
  name: sentin-alert-service # üëà Important: This is the internal DNS Name
spec:
  selector:
    app: sentin-alert
  ports:
    - protocol: TCP
      port: 80      # The service listens on port 80
      targetPort: 3000 # And forwards traffic to container port 3000
  type: ClusterIP   # Internal only (Only Python needs to talk to this)

---
# ==========================================
# 2. Service A: Python (The Sender)
# ==========================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sentin-eye-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: sentin-eye
  template:
    metadata:
      labels:
        app: sentin-eye
    spec:
      containers:
      - name: sentin-eye
        # ‚ö†Ô∏è Note: We are using the new v2 image here
        image: docker.io/YOUR_USER/sentin-eye:v2
        ports:
        - containerPort: 5000
        env:
        # üîó The Magic Link!
        # We tell Python: The alert service is located at this URL
        # Kubernetes DNS resolves "sentin-alert-service" to the correct IP
        - name: ALERT_SERVICE_URL
          value: "http://sentin-alert-service/trigger"
---
apiVersion: v1
kind: Service
metadata:
  name: sentin-eye-service
spec:
  selector:
    app: sentin-eye
  ports:
    - protocol: TCP
      port: 80
      targetPort: 5000
  type: LoadBalancer # Grants a Public IP for browser access